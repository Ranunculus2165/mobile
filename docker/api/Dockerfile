# 1ë‹¨ê³„: Gradle + JDK17 ì´ë¯¸ì§€ë¡œ ë¹Œë“œ
FROM gradle:8.7-jdk17 AS builder

# ğŸ“Œ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œì˜ ì‘ì—… ë””ë ‰í„°ë¦¬
WORKDIR /workspace/api

# ğŸ“Œ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸(.) ê¸°ì¤€ìœ¼ë¡œ api í´ë” ì „ì²´ë¥¼ ë³µì‚¬
#    (ì¦‰, í˜¸ìŠ¤íŠ¸ì˜ WH_EATS/api -> ì»¨í…Œì´ë„ˆ /workspace/api)
COPY api/ .

# ğŸ“Œ ì—¬ê¸°(/workspace/api)ì— build.gradle.kts, settings.gradle.kts, gradlew, src/ ê°€ ìˆì–´ì•¼ í•¨
RUN chmod +x ./gradlew && ./gradlew bootJar --no-daemon

# 2ë‹¨ê³„: ê²½ëŸ‰ JRE ì´ë¯¸ì§€ë¡œ ì‹¤í–‰
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# ìœ„ì—ì„œ ë¹Œë“œëœ JAR ë³µì‚¬
COPY --from=builder /workspace/api/build/libs/*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]
